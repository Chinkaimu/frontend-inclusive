<!DOCTYPE html>
<html>
    <head>
        <title>Reactå°ä¹¦ä¾‹å­</title>
        <style>
            button {margin-left: 10px; margin-top: 5px;}
        </style>
    </head>
    <body>
        <h3>Reactç»„ä»¶åŒ–çš„æ¨å¯¼è¿‡ç¨‹</h3>
        <!-- It lacked facilities for handling data consistenty across shared views. We need events to catch the data, and DOM operations to write data. -->
        <div class="wrapper-1">
            ä¸€ã€åŸç”Ÿå®ç°å•ä¸ªç‚¹èµåŠŸèƒ½
            <button class="like-btn-1">
                <span class="like-text-1">ç‚¹èµ</span>
                <span>ğŸ‘</span>
            </button>
        </div>

        <div class="wrapper-2">äºŒã€å¦‚æœéœ€è¦å¾ˆå¤šç‚¹èµå‘¢ï¼Œç»“æ„è‡ªåŠ¨å¾ªç¯åˆ›å»ºå¤šä¸ª</div>
    
        <div class="wrapper-3">ä¸‰ã€ä½¿ç”¨ç±»ï¼Œï¼ˆ1ï¼‰å®Œæˆäº‹ç‰©çš„æŠ½è±¡ï¼ŒåŒ…å«å±æ€§ã€è¡Œä¸ºç­‰ã€‚ï¼ˆ2ï¼‰å¯¹è±¡çŠ¶æ€æŠ½è±¡ã€‚</div>

        <div class="wrapper-4">å››ã€DOMæ“ä½œä¼˜åŒ–ï¼šéœ€è¦æ“ä½œDOMå°±æ‰§è¡Œrenderæ¥å‡å°‘æ‰‹åŠ¨DOMæ“ä½œã€‚(1)æ‰‹åŠ¨ç®¡ç†æ•°æ®å’Œ DOM ä¹‹é—´çš„å…³ç³»ä¼šå¯¼è‡´ä»£ç å¯ç»´æŠ¤æ€§å˜å·®ã€å®¹æ˜“å‡ºé”™ã€‚æ‰€ä»¥æˆ‘ä»¬è¦åšçš„æ˜¯å‡å°‘æ‰‹åŠ¨DOMæ“ä½œã€‚å…·ä½“æ–¹æ³•æ˜¯åªç•™ä¸‹renderæ–¹æ³•è¿”å›æ–°çš„DOMèŠ‚ç‚¹ï¼Œ
            é€šè¿‡çŠ¶æ€æ”¹å˜åˆ™é‡æ–°è°ƒç”¨renderæ–¹æ³•ï¼Œæ”¹å˜æ¸²æŸ“çš„å†…å®¹ã€‚</div>
        <div class="wrapper-5">(2)æŠ½è±¡å‡ºå…¬å…±ç»„ä»¶ç±»ï¼Œæ‰€æœ‰çš„ç»„ä»¶éƒ½å¯ä»¥ç»§æ‰¿è¿™ä¸ªçˆ¶ç±»æ„å»ºä»¥å®Œæˆå¤ç”¨ã€‚</div>
        <script>
            /**
             * 0. åŸç”Ÿå®ç°å•ä¸ªç‚¹èµåŠŸèƒ½
             */
            const button = document.querySelector('.like-btn-1');
            const buttonText = button.querySelector('.like-text-1');
            let isLiked = false;
            button.addEventListener('click', () => {
                isLiked = !isLiked;
                buttonText.innerHTML = isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'
            }, false)

            /**
             * ã€è‡ªè¡Œè¡¥å……å†…å®¹ã€‘ä»è¿™é‡Œå»æ¨å¯¼å‡ºç”¨ç±»å®ç°çš„ä¼˜åŠ¿ï¼šå¯ä»¥å°†äº‹ä»¶å‡†ç¡®ç»‘å®šåˆ°æ¯ä¸ªèŠ‚ç‚¹ï¼Œä¸éœ€è¦ä¸Šå±‚ç®¡ç†ï¼Œé€»è¾‘å¤æ‚ã€‚
             * æ€æƒ³ï¼šåŒæ¨¡å—åŒ–è‡ªè¡Œé€šè¿‡importç®¡ç†ä¾èµ–æ€æƒ³ç›¸ä¼¼ï¼Œå„ä¸ªå°æ¨¡å—ç®¡ç†è‡ªå·±çš„è¡Œä¸ºäº‹ä»¶ï¼Œè¿™å…¶å®æ˜¯ç±»çš„å®šä¹‰ã€‚
             * 1. å¦‚æœéœ€è¦å¾ˆå¤šç‚¹èµå‘¢ï¼Œç»“æ„è‡ªåŠ¨å¤åˆ¶å¾ªç¯åˆ›å»ºå¤šä¸ª
             * 2. äº‹ä»¶å°±éœ€è¦ç»‘å®šåœ¨æœ€ä¸Šå±‚ï¼Œå¹¶ä¸”å¾—åˆ°ç‚¹å‡»çš„IDå•ä¸ªæ§åˆ¶ã€‚ä¸ä»…å¦‚æ­¤ï¼Œè¿˜éœ€è¦åˆ¤æ–­ç‚¹å‡»äº‹ä»¶è½åœ¨buttonè¿˜æ˜¯spançš„2èŠ‚ç‚¹ï¼Œå› ä¸ºéœ€è¦é‡å†™çš„åªæœ‰spanã€‚
             */
            const buttonHtmlString = '<span class="like-text-2">ç‚¹èµ</span><span>ğŸ‘</span>';
            const wrapper2 = document.querySelector('.wrapper-2');
            const isLikedArray = [];
            for(let i = 0; i < 3; i++){
                let tempString = '<button class="like-btn-2" id=' + i + '>' +  buttonHtmlString + '</button>';
                isLikedArray[i] = false;
                wrapper2.innerHTML += tempString;
            }
            wrapper2.addEventListener('click', (e) => {
                const target = e.target;
                if(target.className === 'like-btn-2') {
                    id = +target.id;

                    isLikedArray[id] = !isLikedArray[id];
                    target.firstChild.innerHTML = isLikedArray[id] ? 'å–æ¶ˆ' : 'ç‚¹èµ';
                } else {
                    let id = +target.parentNode.id;
                    isLikedArray[id] = !isLikedArray[id];
                    target.parentNode.firstChild.innerHTML = isLikedArray[id] ? 'å–æ¶ˆ' : 'ç‚¹èµ';
                }
            })

            /**
             * ä½¿ç”¨ç±»ï¼Œé¢å‘å¯¹è±¡å¼€å‘ï¼Œå®Œæˆäº‹ç‰©çš„æŠ½è±¡ï¼ŒåŒ…å«å±æ€§ã€è¡Œä¸ºç­‰ã€‚ä»æœ€å¼€å§‹çš„å­—ç¬¦ä¸²æ¸²æŸ“åˆ°DOMç»“æ„ã€æ·»åŠ äº‹ä»¶ç­‰ï¼Œä¸€æ­¥æ­¥å®Œå–„å’Œä¼˜åŒ–ã€‚
             */
            class LikeButton1 {
                render() {
                    return '<button class="like-btn-3"><span class="like-text-3">ç‚¹èµ</span><span>ğŸ‘</span></button>'
                }
            }
            // ä¼˜åŒ–1: ä¸ºäº†èƒ½å¤Ÿç»‘å®šäº‹ä»¶ï¼Œå­—ç¬¦ä¸²éœ€è¦è½¬æ¢æˆDOMã€‚ æ·»åŠ äº‹ä»¶ï¼Œæ­¤æ—¶è¿”å›çš„æ˜¯DOMèŠ‚ç‚¹ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡ŒDOM APIè¿›è¡ŒèŠ‚ç‚¹æ’å…¥ã€‚
            const createDOMFromString = domString => {
                const divDOM = document.createElement('div');
                divDOM.innerHTML = domString;
                return divDOM;
            }
            class LikeButton2 {
                render() {
                    this.el = createDOMFromString('<button class="like-btn-3"><span class="like-text-3">ç‚¹èµ</span><span>ğŸ‘</span></button>');
                    this.isLiked = false;
                    this.el.addEventListener('click', ()=>{
                        this.isLiked = !this.isLiked;
                        const linkText = this.el.querySelector('.like-text-3');
                        linkText.innerHTML = this.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ';
                    }, false);
                    return this.el;
                }
            }
            const wrapper3 = document.querySelector('.wrapper-3');
            const likeButtonObj1 = new LikeButton2();
            wrapper3.appendChild(likeButtonObj1.render());            

            // ä¼˜åŒ–2: çŠ¶æ€æŠ½è±¡ã€‚æ²¡æœ‰æƒ³åˆ°çš„ç‚¹ï¼Œç¼ºä¹æŠ½è±¡èƒ½åŠ›ï¼ï¼åœç•™åœ¨ä¸Šé¢ä¼˜åŒ–1çš„å®ç°æ–¹å¼ï¼ˆå°ä¹¦æ— ï¼‰
            // æŠ½è±¡çš„æ„ä¹‰ï¼šï¼ˆ1ï¼‰çŠ¶æ€ç»Ÿä¸€ç®¡ç†ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨renderæ–¹æ³•ä¹‹å¤–å¤„ç†ã€‚å› ä¸ºç»‘å®šåœ¨thisä¸Šï¼Œæ‰€ä»¥æ•´ä¸ªç±»å¯ä»¥å…±äº«çŠ¶æ€ã€‚ï¼ˆ2ï¼‰é‡æ–°è°ƒç”¨renderæ–¹æ³•æ¸²æŸ“çš„åœºæ™¯ï¼Œä¸éœ€è¦å†æ¬¡å®šä¹‰çŠ¶æ€ã€‚
            class LikeButton3 {
                constructor() {
                    this.state = {isLiked: false};
                }

                changeLikeText() {
                    const likeTextNode = this.el.querySelector('.like-text-4');
                    this.state.isLiked = !this.state.isLiked;
                    likeTextNode.innerHTML = this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ';
                }

                render() {
                    this.el = createDOMFromString('<button class="like-btn-4"><span class="like-text-4">ç‚¹èµ</span><span>ğŸ‘</span></button>');
                    this.el.addEventListener('click', () => this.changeLikeText(), false);
                    return this.el;
                }
            }
            const likeButtonObj2 = new LikeButton3();
            wrapper3.appendChild(likeButtonObj2.render());    
            
            // ä¼˜åŒ–3: ä¼˜åŒ–DOMæ“ä½œ
            class LikeButton4 {
                constructor() {
                    this.state = {
                        isLiked: false,
                    }
                }

                changeLikeText() {
                    const oldEl = this.el;
                    this.state = {
                        isLiked: !this.state.isLiked,
                    }
                    this.el = this.render();
                    if(this.onStateChange) this.onStateChange(oldEl, this.el);
                }

                render() {
                    this.el = createDOMFromString(`<button class="like-btn-5"><span class="like-text-5">${this.state.isLiked ? 'å–æ¶ˆ':'ç‚¹èµ'}</span><span>ğŸ‘</span></button>`);
                    this.el.addEventListener('click', () => this.changeLikeText(), false);
                    return this.el;
                }
            }

            const wrapper4 = document.querySelector('.wrapper-4');
            const likeButtonObj3 = new LikeButton4();
            // onStateChangeæ˜¯åœ¨å®ä¾‹åŒ–ä»¥åèƒŒè®¾ç½®çš„ã€‚ TODO: ä¸èƒ½è®¾ç½®ä¸ºç±»çš„é™æ€æ–¹æ³•å—ï¼Ÿï¼ŸJSç±»çš„é™æ€æ–¹æ³•è¯¥æ€ä¹ˆå®ç°ï¼Ÿï¼Ÿ
            likeButtonObj3.onStateChange = (oldEl, newEl) => {
                wrapper4.insertBefore(newEl, oldEl);
                wrapper4.removeChild(oldEl);
            }
            wrapper4.appendChild(likeButtonObj3.render());

            class component {
                constructor(props = {}) {
                    this.props = props;
                }

                setState(state) {
                    const oldEl = this.el;
                    this.state = state;
                    this._renderDOM();
                    if(this.onStateChange) this.onStateChange(oldEl, this.el);
                } 

                _renderDOM() {
                    this.el = createDOMFromString(this.render());
                    // optimize:åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨onClickç­‰å±æ€§ï¼Œå–å¾—ç›¸åº”çš„äº‹ä»¶è°ƒç”¨
                    if(this.onClick) {
                        this.el.addEventListener('click', this.onClick.bind(this), false);
                    }
                    return this.el;
                }
            }

            const mount = (component, wrapper) => {
                wrapper.appendChild(component._renderDOM());
                component.onStateChange = (oldEl, newEl) => {
                    wrapper.insertBefore(newEl, oldEl);
                    wrapper.removeChild(oldEl);
                }
            };

            class LikeButton5 extends component{
                constructor(props) {
                    // è·å–çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•
                    super(props)
                    this.state = {
                        isLiked: false,
                    }
                }

                // onClickäº‹ä»¶å†™åœ¨è¿™é‡Œï¼Œè¿˜æœªç»‘å®šåˆ°å¯¹åº”çš„èŠ‚ç‚¹
                onClick() {
                    this.setState({
                        isLiked: !this.state.isLiked,
                    })
                }

                render() {
                    return `<button class="like-btn-5">
                            <span class="like-text-5">
                                ${this.state.isLiked ? 'å–æ¶ˆ':'ç‚¹èµ'}
                            </span>
                            <span>ğŸ‘</span>
                        </button>`
                }
            }
            
            mount(new LikeButton5(), document.querySelector('.wrapper-5'));
        </script>
    </body>
</html>